@using OutsourceTracker.Models.Trailers

<div class="flex-grow-1 overflow-auto">
    @if (Trailers is null)
    {
        <div class="p-4 text-center text-muted">
            <div class="spinner-border spinner-border-sm" role="status"></div>
            <p class="mt-2">Loading trailers...</p>
        </div>
    }
    else if (!Trailers.Any())
    {
        <div class="p-4 text-center text-muted">
            No trailers found.
        </div>
    }
    else
    {
        <div class="list-group list-group-flush">
            @foreach (var trailer in Trailers)
            {
                var isActive = SelectedId == trailer.Id;
                var isSelected = SelectedTrailers?.Any(t => t.Id == trailer.Id) ?? false;

                <div class="list-group-item list-group-item-action d-flex align-items-center gap-3
                        @(isActive ? "active bg-primary-subtle" : "")"
                     @onclick="@(() => OnTrailerSelected.InvokeAsync(trailer))">

                    <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                               checked="@isSelected"
                               @onchange="@(e => OnToggleSelection.InvokeAsync(trailer))" />
                    </div>

                    <div class="d-flex justify-content-between align-items-center flex-grow-1 small">
                        <div>
                            <strong>@trailer.Prefix@trailer.Name</strong>
                        </div>
                        <div class="text-end text-nowrap">
                            <span class="badge bg-light text-dark">@trailer.State</span>
                            @if (!string.IsNullOrWhiteSpace(trailer.ZoneName))
                            {
                                <span class="badge bg-info ms-1">@trailer.ZoneName</span>
                            }
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>

@code {
    [Parameter] public List<TrailerViewModel>? Trailers { get; set; }
    [Parameter] public Guid? SelectedId { get; set; }
    [Parameter] public IReadOnlyList<TrailerViewModel>? SelectedTrailers { get; set; }
    [Parameter] public EventCallback<TrailerViewModel?> OnTrailerSelected { get; set; }
    [Parameter] public EventCallback<TrailerViewModel> OnToggleSelection { get; set; }  // ← new

    public async Task RefreshAsync()
    {
        await InvokeAsync(StateHasChanged);
    }
}